import{E as U}from"./DHo4l0ZX.js";import"./Dgw27TLR.js";/* empty css        */import{_ as O,f as T,l as k,m as w,r as F,o as _,c as C,F as W,n as Y,a,d as g,t as p,i as u,s as M,b as t,w as s,h as v,p as H,e as j,v as J,x as K}from"./C-CnRt1-.js";import{E as R}from"./QlK9m9KZ.js";import{r as L}from"./BsnG2o04.js";import{E as Q,a as X,b as Z,L as ee}from"./CO8DLequ.js";import{a as te,r as ae,s as oe,b as ne,d as se,m as ie,l as de,p as le,f as re,c as _e,E as ce}from"./6YvAUdkK.js";import{E as fe}from"./DV5L49Kp.js";import{E as ue}from"./CEsXEh1n.js";import{E as he}from"./En43G_UL.js";import"./l0sNRNKZ.js";import"./Bq-MUUjw.js";import"./qEGfapCy.js";import{r as D,f as pe}from"./COMkZ_HI.js";import{e as N}from"./E5P-NQ8u.js";import{A as me}from"./DDzqUooj.js";import{E as ge,A as ke}from"./i-YIZD07.js";import{G as ve}from"./CKp1sPuG.js";import"./Bj0pkxMM.js";import"./Bp3YSIOJ.js";import"./B0qXuZwe.js";import"./D0VbZ-8h.js";import"./CX7TpRRJ.js";import"./B6AwB7wT.js";import"./CzGcHTJI.js";import"./vUDLb0_s.js";import"./BMjuSXxo.js";import"./Cq9Fpw4b.js";import"./B4ArYMfu.js";import"./BudhxryC.js";const Ce=T({props:{pageMode:{type:Number,default:1},onlyShowReadLater:{type:Boolean,default:!1},readedMode:{type:Number,default:0},showSetReadedButton:{type:Boolean,default:!1}},components:{Check:te,Refresh:ae,Select:oe,Share:ne,Reading:se,More:ie,Link:de,Paperclip:le,FullScreen:re,CollectionTag:_e},async asyncData(){return{totalCount:0,feedItems:[],currentPage:1,readLaterList:[],currentFeed:null,feedItem:null}},mounted(){},methods:{async setFeedItemIDs(e,n){let i=[],d=await L.getFeedItemByIDs(!1,e);if(k.isResultOk(d)){i=d.data,await this.loadReadedFlag(i),await this.loadReadLaterFlag(i),await this.loadFeedForFeedItem(i),await this.loadAuthorForFeedItem(i);let l=[];for(let f in e)for(let y in i)if(i[y].feed_item_id==e[f]){l.push(i[y]);break}this.feedItems=l,this.totalCount=n}},async setFeedItems(e,n,i){await this.loadReadedFlag(e),await this.loadReadLaterFlag(e),await this.loadFeedForFeedItem(e),await this.loadAuthorForFeedItem(e),this.currentPage=n,this.feedItems=e,this.totalCount=i},setReadLaterIDList(e){this.readLaterList=e},notifyFeedItemChange(){this.$emit("feedItemCountChange",this.feedItems.length)},isFeedIdExist(e,n){let i=!1;for(let d in n)if(n[d]==e){i=!0;break}return i},async loadReadedFlag(e){let n=[];for(let l in e)e[l].readState=1,this.isFeedIdExist(e[l].feed_item_id,n)||n.push(e[l].feed_item_id);let i=await L.fetchUserFeedItemByIds(w.getDeviceID(),n);if(!k.isResultOk(i))return;let d=i.data;for(let l in e)for(let f in d)d[f].feed_item_id==e[l].feed_item_id&&(e[l].readState=d[f].readed)},async loadReadLaterFlag(e){let n=[];for(let d in e)e[d].isReadLater=!1,this.isFeedIdExist(e[d].feed_item_id,n)||n.push(e[d].feed_item_id);let i=await D.getReadLaterByFeedItems(w.getDeviceID(),n);if(k.isResultOk(i))for(let d in e){let l=e[d].feed_item_id;for(let f in i.data)if(i.data[f].feed_item_id==l){e[d].isReadLater=!0;break}}},async loadFeedForFeedItem(e){let n=[];for(let i in e)e[i].feed=null,this.isFeedIdExist(e[i].feed_id,n)||n.push(e[i].feed_id);if(n.length>0){let i=await L.queryFeedByIDs(!1,n);if(k.isResultOk(i)){let d=i.data.list;for(let l in e)for(let f in d)d[f].feed_id==e[l].feed_id&&(e[l].feed=d[f])}}},async loadAuthorForFeedItem(e){let n=[];for(let d in e)e[d].authorList=[],this.isFeedIdExist(e[d].feed_item_id,n)||n.push(e[d].feed_item_id);let i=await pe.fetchAuthor(!1,n);if(k.isResultOk(i)){let d=i.data;for(let l in d)for(let f in e)if(d[l].feed_item_id==e[f].feed_item_id){e[f].authorList.push(d[l]);break}}},formatHumanTime(e){return k.getHumanTime(e)},showFeedItem(e){N.emit("on_popup_feeditem_content",{feed:e.feed,feedItem:e})},loadMore(){this.pageMode!=1},handlePageChange(e){this.$emit("onPageChange",{pageNumber:parseInt(e)})},onSetReadAndNextPage(){this.$emit("setReadedAndNextPage",{feedItems:this.feedItems,currentPage:this.currentPage})},removeByFeedItemID(e){let n=0;for(;n<this.feedItems.length;)this.feedItems[n].feed_item_id===e?this.feedItems.splice(n,1):++n;this.notifyFeedItemChange()},async onSetFeedItemState(e,n){let i=parseInt(n),d=await L.setFeedItemReadState(w.getDeviceID(),e.feed_item_id,i);k.isResultOk(d)?e.readState=i:R.error('设置为"'+(i==1?"未读":"已读")+'"失败，请稍后再试。')},async setReadLater(e){let n=await D.setReadLater(w.getDeviceID(),e.feed_id,e.feed_item_id);k.isResultOk(n)?e.isReadLater=!0:R.error('设置“稍后阅读"失败，请稍后再试。')},async removeReadLater(e){let n=await D.removeReadLater(w.getDeviceID(),e.feed_item_id);k.isResultOk(n)?(this.onlyShowReadLater&&this.removeByFeedItemID(e.feed_item_id),e.isReadLater=!1):R.error('取消“稍后阅读"失败，请稍后再试。')},onShareArticle(){},setPageIndex(e){this.currentPage=e},onFeedClick(e){N.emit("on_popup_feed",{feed:e})},loadMoreFeedItem(){}}},"$5rOHbgHksb"),m=e=>(H("data-v-26789c3e"),e=e(),j(),e),Fe={key:0},ye=["onClick"],Ie=["src"],we={class:"feed_item_list_img_container"},Se=["src"],Le={class:"feed_item_list_content_container"},Re=["onClick"],be={class:"feed_item_list_container_desc"},$e={style:{display:"flex","margin-top":"5px"}},De={style:{height:"30px","line-height":"30px"}},ze={class:"feed_item_list_container_time"},Ee=m(()=>a("span",{class:"feed_item_list_container_time"}," · ",-1)),Pe={class:"feed_item_list_container_time"},xe=m(()=>a("div",{style:{flex:"1"}},null,-1)),Ae=["onClick"],Be=m(()=>a("span",null," ",-1)),Me=["onClick"],Ne=["onClick"],Oe=m(()=>a("span",null," ",-1)),Te=["onClick"],He=["onClick"],je=m(()=>a("span",null," ",-1)),Ve={class:"svg_icon_container_mini"},qe=["href"],Ge=["href"],Ue={key:1},We=["onClick"],Ye=["src"],Je={class:"feed_item_list_container"},Ke=["onClick"],Qe={class:"feed_item_list_container_desc"},Xe={style:{display:"flex","margin-top":"5px"}},Ze={style:{height:"30px","line-height":"30px"}},et={class:"feed_item_list_container_time"},tt=m(()=>a("span",{class:"feed_item_list_container_time"}," · ",-1)),at={class:"feed_item_list_container_time"},ot=m(()=>a("div",{style:{flex:"1"}},null,-1)),nt=["onClick"],st=m(()=>a("span",null," ",-1)),it=["onClick"],dt=["onClick"],lt=m(()=>a("span",null," ",-1)),rt=["onClick"],_t=["onClick"],ct=m(()=>a("span",null," ",-1)),ft={class:"svg_icon_container_mini"},ut=["href"],ht=["href"],pt={key:0,style:{margin:"30px 0px","text-align":"center"}},mt=m(()=>a("div",{style:{height:"30px"}},null,-1));function gt(e,n,i,d,l,f){const y=F("Reading"),r=ce,h=fe,S=F("Check"),b=F("CollectionTag"),z=F("More"),E=F("Share"),I=Q,P=F("FullScreen"),x=F("Paperclip"),A=X,B=Z,V=ue,q=he;return _(),C("div",null,[(_(!0),C(W,null,Y(e.feedItems,(o,G)=>(_(),C("div",{key:G,style:{"margin-top":"20px","margin-bottom":"20px","border-bottom":"1px solid #eee","padding-bottom":"10px"}},[o.thumb_url.length>0?(_(),C("div",Fe,[a("div",null,[o.feed!=null?(_(),C("a",{key:0,target:"_blank",onClick:c=>e.onFeedClick(o.feed),class:"feed_name_img"},[a("img",{src:o.feed.icon_url},null,8,Ie),g(" "+p(o.feed.name)+p(o.authorList.length>0?" · "+o.authorList[0].author_name:""),1)],8,ye)):u("",!0),a("div",we,[a("img",{class:"feed_item_img",src:o.thumb_url},null,8,Se),a("div",Le,[a("a",{onClick:c=>e.showFeedItem(o),class:M(["feed_item_list_container_title",{feed_item_list_container_title_readed:o.readState!=1}])},p(o.title),11,Re),a("p",be,p(o.desc),1),a("div",$e,[a("div",De,[a("span",ze,p(e.formatHumanTime(o.publish_time)),1),Ee,a("span",Pe,p(o.read_count)+"次阅读",1)]),xe,t(h,{effect:"dark",content:"快速阅读此文章",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.showFeedItem(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(y)]),_:1})],8,Ae)]),_:2},1024),Be,o.readState==1?(_(),v(h,{key:0,effect:"dark",content:"标记为已读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.onSetFeedItemState(o,2),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(S)]),_:1})],8,Me)]),_:2},1024)):u("",!0),o.readState!=1?(_(),v(h,{key:1,effect:"dark",content:"标记为未读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.onSetFeedItemState(o,1),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(S)]),_:1})],8,Ne)]),_:2},1024)):u("",!0),Oe,o.isReadLater?u("",!0):(_(),v(h,{key:2,effect:"dark",content:"添加到稍后阅读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.setReadLater(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(b)]),_:1})],8,Te)]),_:2},1024)),o.isReadLater?(_(),v(h,{key:3,effect:"dark",content:"取消稍后阅读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.removeReadLater(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#009a61"},{default:s(()=>[t(b)]),_:1})],8,He)]),_:2},1024)):u("",!0),je,t(B,{placement:"bottom-end"},{dropdown:s(()=>[t(A,null,{default:s(()=>[t(I,null,{default:s(()=>[a("a",{class:"article_link",onClick:n[0]||(n[0]=(...c)=>e.onShareArticle&&e.onShareArticle(...c)),target:"_blank"},[t(r,{size:18},{default:s(()=>[t(E)]),_:1}),g("分享给朋友")])]),_:1}),t(I,null,{default:s(()=>[a("a",{class:"article_link",href:"/feed-item/"+o.feed_item_id+".html",target:"_blank"},[t(r,{size:18},{default:s(()=>[t(P)]),_:1}),g("在新窗口打开")],8,qe)]),_:2},1024),t(I,null,{default:s(()=>[a("a",{class:"article_link",href:o.feed_url,target:"_blank"},[t(r,{size:18},{default:s(()=>[t(x)]),_:1}),g("原文链接")],8,Ge)]),_:2},1024)]),_:2},1024)]),default:s(()=>[a("div",Ve,[t(r,{size:20,color:"#757575"},{default:s(()=>[t(z)]),_:1})])]),_:2},1024)])])])])])):u("",!0),o.thumb_url.length==0?(_(),C("div",Ue,[o.feed!=null?(_(),C("a",{key:0,target:"_blank",onClick:c=>e.onFeedClick(o.feed),class:"feed_name_img"},[a("img",{src:o.feed.icon_url},null,8,Ye),g(" "+p(o.feed.name)+p(o.authorList.length>0?" · "+o.authorList[0].author_name:""),1)],8,We)):u("",!0),a("a",Je,[a("a",{onClick:c=>e.showFeedItem(o),class:M(["feed_item_list_container_title",{feed_item_list_container_title_readed:o.readState!=1}])},p(o.title),11,Ke),a("p",Qe,p(o.desc),1)]),a("div",Xe,[a("div",Ze,[a("span",et,p(e.formatHumanTime(o.publish_time)),1),tt,a("span",at,p(o.read_count)+"次阅读",1)]),ot,t(h,{effect:"dark",content:"快速阅读此文章",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.showFeedItem(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(y)]),_:1})],8,nt)]),_:2},1024),st,o.readState==1?(_(),v(h,{key:0,effect:"dark",content:"标记为已读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.onSetFeedItemState(o,2),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(S)]),_:1})],8,it)]),_:2},1024)):u("",!0),o.readState!=1?(_(),v(h,{key:1,effect:"dark",content:"标记为未读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.onSetFeedItemState(o,1),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(S)]),_:1})],8,dt)]),_:2},1024)):u("",!0),lt,o.isReadLater?u("",!0):(_(),v(h,{key:2,effect:"dark",content:"添加到稍后阅读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.setReadLater(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#757575"},{default:s(()=>[t(b)]),_:1})],8,rt)]),_:2},1024)),o.isReadLater?(_(),v(h,{key:3,effect:"dark",content:"取消稍后阅读",placement:"top-start"},{default:s(()=>[a("div",{onClick:c=>e.removeReadLater(o),class:"svg_icon_container_mini"},[t(r,{size:20,color:"#009a61"},{default:s(()=>[t(b)]),_:1})],8,_t)]),_:2},1024)):u("",!0),ct,t(B,{placement:"bottom-end"},{dropdown:s(()=>[t(A,null,{default:s(()=>[t(I,null,{default:s(()=>[a("a",{class:"article_link",onClick:n[1]||(n[1]=(...c)=>e.onShareArticle&&e.onShareArticle(...c)),target:"_blank"},[t(r,{size:18},{default:s(()=>[t(E)]),_:1}),g("分享给朋友")])]),_:1}),t(I,null,{default:s(()=>[a("a",{class:"article_link",href:"/feed-item/"+o.feed_item_id+".html",target:"_blank"},[t(r,{size:18},{default:s(()=>[t(P)]),_:1}),g("在新窗口打开")],8,ut)]),_:2},1024),t(I,null,{default:s(()=>[a("a",{class:"article_link",href:o.feed_url,target:"_blank"},[t(r,{size:18},{default:s(()=>[t(x)]),_:1}),g("原文链接")],8,ht)]),_:2},1024)]),_:2},1024)]),default:s(()=>[a("div",ft,[t(r,{size:20,color:"#757575"},{default:s(()=>[t(z)]),_:1})])]),_:2},1024)])])):u("",!0)]))),128)),e.showSetReadedButton?(_(),C("div",pt,[t(V,{onClick:e.onSetReadAndNextPage,size:"large",style:{width:"100%"}},{default:s(()=>[g("    "),t(r,{size:24,color:"#757575"},{default:s(()=>[t(S)]),_:1}),g("  本页已读，加载下一页     ")]),_:1},8,["onClick"])])):u("",!0),e.pageMode==1?(_(),v(q,{key:1,onCurrentPage:e.currentPage,onCurrentChange:e.handlePageChange,background:"",layout:"prev, pager, next",total:e.totalCount,"page-size":30},null,8,["onCurrentPage","onCurrentChange","total"])):u("",!0),mt])}const kt=O(Ce,[["render",gt],["__scopeId","data-v-26789c3e"]]),vt=T({components:{Loading:ee,EmptyFolder:ge,FeedItemList:kt,AddRssWhite:me,Good:ve,AllDoneFolder:ke},async asyncData(){return{viewState:1,totalCount:0}},mounted(){this.loadFeedItems(1)},methods:{async loadFeedItems(e){let n=await L.getUserFeedItems(w.getDeviceID(),2,30,(e-1)*30);if(!k.isResultOk(n)){R.error("文章列表加载失败，请检查网络或稍后再试。");return}let i=n.data.list,d=n.data.total_count;if(d==0)this.viewState=2;else{let l=[];for(let f in i)l.push(i[f].feed_item_id);await this.$refs.feedItemListComp.setFeedItemIDs(l,d),this.viewState=3}},onSubscribeFeed(){window.location.href="/feed/website/ft/1.html"},onFeedItemCountChange(e){e==0&&(this.viewState=2)},async onPageChange(e){await this.loadFeedItems(e.pageNumber),R.success("已为您加载新的内容。")}}},"$zLqsY0aCD3"),$=e=>(H("data-v-10d2f665"),e=e(),j(),e),Ct={class:"page_root_container"},Ft=$(()=>a("h2",{class:"page_root_title"},"已读文章",-1)),yt={key:1,style:{width:"800px",margin:"0px auto","text-align":"center"}},It=$(()=>a("img",{src:"https://oss-cn-hangzhou.aliyuncs.com/codingsky/hellokit/assets/image/reader/read-latre.svg"},null,-1)),wt=$(()=>a("p",{style:{"margin-bottom":"0px","font-size":"30px"}},"空空如也",-1)),St=$(()=>a("p",{style:{"margin-bottom":"0px","font-size":"16px"}},"你标记为“已读”的文章会出现在这里。",-1)),Lt=[It,wt,St];function Rt(e,n,i,d,l,f){const y=U,r=F("Loading"),h=F("FeedItemList");return _(),C("div",Ct,[Ft,t(y),e.viewState==1?(_(),v(r,{key:0})):u("",!0),e.viewState==2?(_(),C("div",yt,Lt)):u("",!0),J(t(h,{onFeedItemCountChange:e.onFeedItemCountChange,onOnPageChange:e.onPageChange,readedMode:2,pageMode:1,ref:"feedItemListComp"},null,8,["onFeedItemCountChange","onOnPageChange"]),[[K,e.viewState==3]])])}const sa=O(vt,[["render",Rt],["__scopeId","data-v-10d2f665"]]);export{sa as default};
