import{e as V,g as z,h as K,E as N}from"./6YvAUdkK.js";import{E as O}from"./CEsXEh1n.js";import{E as P}from"./BMjuSXxo.js";import{E as T}from"./DV5L49Kp.js";import{E as A}from"./En43G_UL.js";import"./Dgw27TLR.js";/* empty css        */import"./qEGfapCy.js";import"./l0sNRNKZ.js";import"./Bq-MUUjw.js";import{_ as j,f as q,c as w,b as c,w as u,q as U,a as o,t as p,F as Q,n as M,j as Y,k as S,l as g,m as b,r as F,o as k,d as v,i as x,h as L,p as G,e as H}from"./C-CnRt1-.js";import{e as D}from"./E5P-NQ8u.js";import{r as y}from"./BsnG2o04.js";import{r as E}from"./B5cJlPgj.js";import"./CzGcHTJI.js";import"./Bj0pkxMM.js";import"./D0VbZ-8h.js";import"./B0qXuZwe.js";import"./CX7TpRRJ.js";import"./Bp3YSIOJ.js";import"./Cq9Fpw4b.js";import"./vUDLb0_s.js";import"./B4ArYMfu.js";import"./BudhxryC.js";import"./B6AwB7wT.js";const J=q({components:{Search:V,FolderAdd:z,FolderChecked:K},async asyncData(){let e,t;const a=Y();parseInt(a.params.page);let n=a.params.text;(n==null||n==null)&&(n="");let s=[],d=[],f=0,r=([e,t]=S(()=>y.searchFeed(!0,n,2,30,0)),e=await e,t(),e);g.isResultOk(r)&&(s=r.data.list,f=r.data.total_count);for(let l in s)s[l].folderList=[],s[l].feed_item_count=0,s[l].recent_feeditem_count=0,s[l].read_count=0,s[l].follow_count=0,d.push(s[l].feed_id);let C=([e,t]=S(()=>y.queryFeedStaticsByIDs(!0,d)),e=await e,t(),e);if(g.isResultOk(C)){let l=C.data;for(let h in l)for(let m in s)if(s[m].feed_id==l[h].feed_id){s[m].feed_item_count=l[h].feed_item_count,s[m].recent_feeditem_count=l[h].recent_feeditem_count,s[m].read_count=l[h].read_count,s[m].follow_count=l[h].follow_count;break}}return{feeds:s,text:n,urlText:n,totalCount:f,totalFeedItemCount:0,pageNumber:1}},mounted(){this.fetchFeedFolder(),D.on("on_feed_folder_update",e=>{this.onFeedFolderUpdate(e)})},methods:{async fetchFeedFolder(){if(this.feeds==null)return;let e=[];for(let n in this.feeds)e.push(this.feeds[n].feed_id);let t=await E.getFolderIDByFeedIDs(b.getDeviceID(),e);if(g.isResultOk(t)){let n=t.data;for(let s in n)for(var a in this.feeds)this.feeds[a].feed_id==n[s].feed_id&&(this.feeds[a].folderList=n[s].user_folder_list)}},onSubscribeClick(e){D.emit("on_popup_selectfolder",{currentFeed:e,action:1})},async onFeedFolderUpdate(e){let t=e.feed.feed_id,a=await E.getFolderIDByFeedIDs(b.getDeviceID(),[t]);if(g.isResultOk(a))for(var n in this.feeds)this.feeds[n].feed_id==t&&(a.data.length==1?this.feeds[n].folderList=a.data[0].user_folder_list:this.feeds[n].folderList=[])},wrapCountDisplay(e){return e<1e3?e:e<1e3*1e3?(e/1e3).toFixed(2)+"K":e<1e3*1e3*1e3?(e/(1e3*1e3)).toFixed(2)+"M":e<1e3*1e3*1e3*1e3?(e/(1e3*1e3*1e3)).toFixed(2)+"B":"Infinity"},onSearchClick(){window.location.href="/feed/search/"+this.text},async loadPage(e){let t=[],a=[],n=await y.searchFeed(!0,urlText,2,30,(e-1)*30);g.isResultOk(n)&&(t=n.data.list,n.data.total_count);for(let d in t)t[d].folderList=[],t[d].feed_item_count=0,t[d].recent_feeditem_count=0,t[d].read_count=0,t[d].follow_count=0,a.push(t[d].feed_id);let s=await y.queryFeedStaticsByIDs(!0,a);if(g.isResultOk(s)){let d=s.data;for(let f in d)for(let r in t)if(t[r].feed_id==d[f].feed_id){t[r].feed_item_count=d[f].feed_item_count,t[r].recent_feeditem_count=d[f].recent_feeditem_count,t[r].read_count=d[f].read_count,t[r].follow_count=d[f].follow_count;break}}this.feeds=t},handlePageChange(e){this.loadPage(parseInt(e))},onFeedClick(e){D.emit("on_popup_feed",{feed:e})},onInputKeyDown(e){this.text.length==0?window.location.href="/feed/website/ft/1.html":window.location.href="/feed/search/"+this.text}}},"$ejYTspQQe5"),_=e=>(G("data-v-1120e051"),e=e(),H(),e),W={style:{width:"800px",margin:"0px auto","padding-top":"35px"}},X=_(()=>o("h2",null,"搜索您想看的频道",-1)),Z={style:{"margin-bottom":"5px","margin-top":"30px"}},ee={class:"feed_container_top"},te=["src"],oe={style:{flex:"1","margin-left":"10px"}},se=["onClick"],ne=_(()=>o("br",null,null,-1)),de=["href"],ie={class:"feed_desc"},le={style:{display:"flex","padding-left":"50px","margin-top":"15px"}},ae={class:"feed_counter"},re=_(()=>o("p",null,"订阅",-1)),fe=_(()=>o("div",{style:{flex:"1"}},null,-1)),ce={class:"feed_counter"},_e=_(()=>o("p",null,"累计阅读",-1)),ue=_(()=>o("div",{style:{flex:"1"}},null,-1)),pe={class:"feed_counter"},he=_(()=>o("p",null,"文章",-1)),me=_(()=>o("div",{style:{flex:"1"}},null,-1)),Ce={class:"feed_counter"},ge=_(()=>o("p",null,"最近更新",-1));function ke(e,t,a,n,s,d){const f=F("Search"),r=N,C=O,l=P,h=F("FolderAdd"),m=F("FolderChecked"),R=T,B=A;return k(),w("div",W,[X,c(l,{modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=i=>e.text=i),onKeyup:U(e.onInputKeyDown,["enter","native"]),size:"large",placeholder:"",class:"input-with-select"},{append:u(()=>[c(C,{onClick:e.onSearchClick},{default:u(()=>[c(r,null,{default:u(()=>[c(f)]),_:1}),v("  搜索")]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeyup"]),o("p",Z,"共 "+p(e.totalCount)+" 条结果",1),(k(!0),w(Q,null,M(e.feeds,(i,$)=>(k(),w("div",{key:$,class:"feed_container"},[o("div",ee,[o("img",{src:i.icon_url},null,8,te),o("div",oe,[o("a",{class:"feed_name",onClick:I=>e.onFeedClick(i)},p(i.name),9,se),ne,o("a",{class:"feed_url",href:i.url},p(i.url),9,de),o("p",ie,p(i.desc),1)]),o("div",null,[x("",!0),i.folderList.length==0?(k(),L(C,{key:1,onClick:I=>e.onSubscribeClick(i)},{default:u(()=>[c(r,{size:16},{default:u(()=>[c(h)]),_:1}),v(" 订阅")]),_:2},1032,["onClick"])):x("",!0),i.folderList.length>0?(k(),L(R,{key:2,effect:"dark",content:"取消订阅或转移至其它目录",placement:"right"},{default:u(()=>[c(C,{onClick:I=>e.onSubscribeClick(i)},{default:u(()=>[c(r,{size:16},{default:u(()=>[c(m)]),_:1}),v(" 修改")]),_:2},1032,["onClick"])]),_:2},1024)):x("",!0)])]),o("div",le,[o("div",ae,[o("p",null,p(e.wrapCountDisplay(i.follow_count)),1),re]),fe,o("div",ce,[o("p",null,p(e.wrapCountDisplay(i.read_count)),1),_e]),ue,o("div",pe,[o("p",null,p(e.wrapCountDisplay(i.feed_item_count)),1),he]),me,o("div",Ce,[o("p",null,p(e.wrapCountDisplay(i.recent_feeditem_count)),1),ge])])]))),128)),c(B,{background:"",layout:"prev, pager, next",onCurrentChange:e.handlePageChange,"page-size":30,total:e.totalCount},null,8,["onCurrentChange","total"])])}const Qe=j(J,[["render",ke],["__scopeId","data-v-1120e051"]]);export{Qe as default};
