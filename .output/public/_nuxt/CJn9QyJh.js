import{a as O,r as P,s as H,b as j,d as V,m as X,l as q,p as J,f as $,c as U,E as Z}from"./6YvAUdkK.js";import{E as ie}from"./CEsXEh1n.js";import"./Dgw27TLR.js";/* empty css        */import{_ as G,f as K,l as g,r as _,o as r,c as p,a as i,d as I,t as h,i as c,s as Q,b as o,w as a,h as v,p as W,e as Y,m as y,F as ne,n as ae}from"./C-CnRt1-.js";import{E as T}from"./QlK9m9KZ.js";import{r as C}from"./BsnG2o04.js";import{r as N,f as se}from"./COMkZ_HI.js";import{e as D}from"./E5P-NQ8u.js";import{E as x}from"./DV5L49Kp.js";import{E as ee,a as te,b as oe}from"./CO8DLequ.js";import"./l0sNRNKZ.js";import"./Bq-MUUjw.js";const de=K({props:{feedItem:{type:Object,default:null},showFeedName:{type:Boolean,default:!0}},components:{Check:O,Refresh:P,Select:H,Share:j,Reading:V,More:X,Link:q,Paperclip:J,FullScreen:$,CollectionTag:U,FullScreen:$},async asyncData(){return{}},mounted(){},destroyed(){},methods:{onFeedClick(e){D.emit("on_popup_feed",{feed:e})},async onSetFeedItemState(e,t){this.$emit("onSetFeedItemState",{feedItem:e,readState:t})},async setReadLater(e){this.$emit("setReadLater",{feedItem:e})},async removeReadLater(e){this.$emit("removeReadLater",{feedItem:e})},showFeedItem(e){D.emit("on_popup_feeditem_content",{feed:e.feed,feedItem:e})},onShareArticle(){},formatHumanTime(e){return g.getHumanTime(e)}}},"$nz0P46CkPT"),b=e=>(W("data-v-d3ab8030"),e=e(),Y(),e),le=["src"],re={class:"feed_item_list_container"},me={class:"feed_item_list_container_desc"},fe={style:{display:"flex","margin-top":"5px"}},_e={style:{height:"30px","line-height":"30px"}},ce={class:"feed_item_list_container_time"},ue=b(()=>i("span",{class:"feed_item_list_container_time"}," · ",-1)),he={class:"feed_item_list_container_time"},pe=b(()=>i("div",{style:{flex:"1"}},null,-1)),Ie=b(()=>i("span",null," ",-1)),ge=b(()=>i("span",null," ",-1)),Fe=b(()=>i("span",null," ",-1)),ke={class:"svg_icon_container_mini"},Se=["href"],ve=["href"];function Re(e,t,n,s,d,m){const L=_("Reading"),l=Z,u=x,F=_("Check"),k=_("CollectionTag"),S=_("More"),w=_("Share"),R=ee,z=_("FullScreen"),E=_("Paperclip"),B=te,A=oe;return r(),p("div",null,[i("div",null,[e.showFeedName&&e.feedItem.feed!=null?(r(),p("a",{key:0,target:"_blank",onClick:t[0]||(t[0]=f=>e.onFeedClick(e.feedItem.feed)),class:"feed_name_img"},[i("img",{src:e.feedItem.feed.icon_url},null,8,le),I(" "+h(e.feedItem.feed.name)+h(e.feedItem.authorList.length>0?" · "+e.feedItem.authorList[0].author_name:""),1)])):c("",!0),i("a",re,[i("a",{onClick:t[1]||(t[1]=f=>e.showFeedItem(e.feedItem)),class:Q(["feed_item_list_container_title",{feed_item_list_container_title_readed:e.feedItem.readState!=1}])},h(e.feedItem.title),3),i("p",me,h(e.feedItem.desc),1)]),i("div",fe,[i("div",_e,[i("span",ce,h(e.formatHumanTime(e.feedItem.publish_time)),1),ue,i("span",he,h(e.feedItem.read_count)+"次阅读",1)]),pe,o(u,{effect:"dark",content:"快速阅读此文章",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[2]||(t[2]=f=>e.showFeedItem(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(L)]),_:1})])]),_:1}),Ie,e.feedItem.readState==1?(r(),v(u,{key:0,effect:"dark",content:"标记为已读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[3]||(t[3]=f=>e.onSetFeedItemState(e.feedItem,2)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(F)]),_:1})])]),_:1})):c("",!0),e.feedItem.readState!=1?(r(),v(u,{key:1,effect:"dark",content:"标记为未读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[4]||(t[4]=f=>e.onSetFeedItemState(e.feedItem,1)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(F)]),_:1})])]),_:1})):c("",!0),ge,e.feedItem.isReadLater?c("",!0):(r(),v(u,{key:2,effect:"dark",content:"添加到稍后阅读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[5]||(t[5]=f=>e.setReadLater(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(k)]),_:1})])]),_:1})),e.feedItem.isReadLater?(r(),v(u,{key:3,effect:"dark",content:"取消稍后阅读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[6]||(t[6]=f=>e.removeReadLater(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#009a61"},{default:a(()=>[o(k)]),_:1})])]),_:1})):c("",!0),Fe,o(A,{placement:"bottom-end"},{dropdown:a(()=>[o(B,null,{default:a(()=>[o(R,null,{default:a(()=>[i("a",{class:"article_link",onClick:t[7]||(t[7]=(...f)=>e.onShareArticle&&e.onShareArticle(...f)),target:"_blank"},[o(l,{size:18},{default:a(()=>[o(w)]),_:1}),I("分享给朋友")])]),_:1}),o(R,null,{default:a(()=>[i("a",{class:"article_link",href:"/feed-item/"+e.feedItem.feed_item_id+".html",target:"_blank"},[o(l,{size:18},{default:a(()=>[o(z)]),_:1}),I("在新窗口打开")],8,Se)]),_:1}),o(R,null,{default:a(()=>[i("a",{class:"article_link",href:e.feedItem.feed_url,target:"_blank"},[o(l,{size:18},{default:a(()=>[o(E)]),_:1}),I("原文链接")],8,ve)]),_:1})]),_:1})]),default:a(()=>[i("div",ke,[o(l,{size:20,color:"#757575"},{default:a(()=>[o(S)]),_:1})])]),_:1})])])])}const ye=G(de,[["render",Re],["__scopeId","data-v-d3ab8030"]]),$e=K({props:{feedItem:{type:Object,default:null},showFeedName:{type:Boolean,default:!0}},components:{Check:O,Refresh:P,Select:H,Share:j,Reading:V,More:X,Link:q,Paperclip:J,FullScreen:$,CollectionTag:U,FullScreen:$},async asyncData(){return{}},mounted(){},destroyed(){},methods:{onFeedClick(e){D.emit("on_popup_feed",{feed:e})},async onSetFeedItemState(e,t){this.$emit("onSetFeedItemState",{feedItem:e,readState:t})},async setReadLater(e){this.$emit("setReadLater",{feedItem:e})},async removeReadLater(e){this.$emit("removeReadLater",{feedItem:e})},showFeedItem(e){D.emit("on_popup_feeditem_content",{feed:e.feed,feedItem:e})},onShareArticle(){},formatHumanTime(e){return g.getHumanTime(e)}}},"$uJTzAXBRww"),M=e=>(W("data-v-d080d948"),e=e(),Y(),e),Le=["src"],we={class:"feed_item_list_img_container"},Ce=["src"],be={class:"feed_item_list_content_container"},Me={class:"feed_item_list_container_desc"},Te={style:{display:"flex","margin-top":"5px"}},De={style:{height:"30px","line-height":"30px"}},ze={class:"feed_item_list_container_time"},Ee=M(()=>i("span",{class:"feed_item_list_container_time"}," · ",-1)),Be={class:"feed_item_list_container_time"},Ae=M(()=>i("div",{style:{flex:"1"}},null,-1)),Ne=M(()=>i("span",null," ",-1)),Oe=M(()=>i("span",null," ",-1)),Pe=M(()=>i("span",null," ",-1)),He={class:"svg_icon_container_mini"},je=["href"],Ve=["href"];function Xe(e,t,n,s,d,m){const L=_("Reading"),l=Z,u=x,F=_("Check"),k=_("CollectionTag"),S=_("More"),w=_("Share"),R=ee,z=_("FullScreen"),E=_("Paperclip"),B=te,A=oe;return r(),p("div",null,[e.showFeedName&&e.feedItem.feed!=null?(r(),p("a",{key:0,target:"_blank",onClick:t[0]||(t[0]=f=>e.onFeedClick(e.feedItem.feed)),class:"feed_name_img"},[i("img",{src:e.feedItem.feed.icon_url},null,8,Le),I(" "+h(e.feedItem.feed.name)+h(e.feedItem.authorList.length>0?" · "+e.feedItem.authorList[0].author_name:""),1)])):c("",!0),i("div",we,[i("img",{class:"feed_item_img",src:e.feedItem.thumb_url},null,8,Ce),i("div",be,[i("a",{onClick:t[1]||(t[1]=f=>e.showFeedItem(e.feedItem)),class:Q(["feed_item_list_container_title",{feed_item_list_container_title_readed:e.feedItem.readState!=1}])},h(e.feedItem.title),3),i("p",Me,h(e.feedItem.desc),1),i("div",Te,[i("div",De,[i("span",ze,h(e.formatHumanTime(e.feedItem.publish_time)),1),Ee,i("span",Be,h(e.feedItem.read_count)+"次阅读",1)]),Ae,o(u,{effect:"dark",content:"快速阅读此文章",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[2]||(t[2]=f=>e.showFeedItem(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(L)]),_:1})])]),_:1}),Ne,e.feedItem.readState==1?(r(),v(u,{key:0,effect:"dark",content:"标记为已读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[3]||(t[3]=f=>e.onSetFeedItemState(e.feedItem,2)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(F)]),_:1})])]),_:1})):c("",!0),e.feedItem.readState!=1?(r(),v(u,{key:1,effect:"dark",content:"标记为未读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[4]||(t[4]=f=>e.onSetFeedItemState(e.feedItem,1)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(F)]),_:1})])]),_:1})):c("",!0),Oe,e.feedItem.isReadLater?c("",!0):(r(),v(u,{key:2,effect:"dark",content:"添加到稍后阅读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[5]||(t[5]=f=>e.setReadLater(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#757575"},{default:a(()=>[o(k)]),_:1})])]),_:1})),e.feedItem.isReadLater?(r(),v(u,{key:3,effect:"dark",content:"取消稍后阅读",placement:"top-start"},{default:a(()=>[i("div",{onClick:t[6]||(t[6]=f=>e.removeReadLater(e.feedItem)),class:"svg_icon_container_mini"},[o(l,{size:20,color:"#009a61"},{default:a(()=>[o(k)]),_:1})])]),_:1})):c("",!0),Pe,o(A,{placement:"bottom-end"},{dropdown:a(()=>[o(B,null,{default:a(()=>[o(R,null,{default:a(()=>[i("a",{class:"article_link",onClick:t[7]||(t[7]=(...f)=>e.onShareArticle&&e.onShareArticle(...f)),target:"_blank"},[o(l,{size:18},{default:a(()=>[o(w)]),_:1}),I("分享给朋友")])]),_:1}),o(R,null,{default:a(()=>[i("a",{class:"article_link",href:"/feed-item/"+e.feedItem.feed_item_id+".html",target:"_blank"},[o(l,{size:18},{default:a(()=>[o(z)]),_:1}),I("在新窗口打开")],8,je)]),_:1}),o(R,null,{default:a(()=>[i("a",{class:"article_link",href:e.feedItem.feed_url,target:"_blank"},[o(l,{size:18},{default:a(()=>[o(E)]),_:1}),I("原文链接")],8,Ve)]),_:1})]),_:1})]),default:a(()=>[i("div",He,[o(l,{size:20,color:"#757575"},{default:a(()=>[o(S)]),_:1})])]),_:1})])])])])}const qe=G($e,[["render",Xe],["__scopeId","data-v-d080d948"]]),Je=K({props:{readedMode:{type:Number,default:0},showFeedName:{type:Boolean,default:!0},readLaterMode:{type:Boolean,default:!1}},components:{Check:O,Refresh:P,Select:H,Share:j,Reading:V,More:X,Link:q,Paperclip:J,FullScreen:$,CollectionTag:U,FullScreen:$,TextItem:ye,ThumbItem:qe},async asyncData(){return{totalCount:0,loadedCount:0,feedItems:[],feedsCount:0,disabledLoadMore:!1,loadingMore:!1,loadFinish:!1,loadTooMuch:!1,currentFeed:null,feedItem:null,element:null,distance:200}},mounted(){this.$nextTick(()=>{window.addEventListener("scroll",this.listenBottomOut,!0),this.element=document.getElementById("right_content_rootcontainer")})},destroyed(){window.removeEventListener("scroll",this.listenBottomOut,!1)},methods:{isFeedItemExist(e){for(let t in this.feedItems)if(this.feedItems[t].feed_item_id==e)return!0;return!1},async appendFeedItemIDs(e){if(e.length==0){this.loadFinish=!0,this.loadingMore=!1;return}let t=[],n=await C.getFeedItemByIDs(!1,e);if(g.isResultOk(n)){t=n.data;let s=[];for(let d in e)for(let m in t)if(e[d]==t[m].feed_item_id){s.push(t[m]);break}await this.loadReadedFlag(s),await this.loadReadLaterFlag(s),await this.loadFeedForFeedItem(s),await this.loadAuthorForFeedItem(s),this.feedItems.push(...s),this.buildFeedCount(),this.loadingMore=!1,console.log(this.feedItems),console.log("======="),this.feedItems.length>=100&&(this.loadTooMuch=!0)}},async appendFeedItems(e){if(e.length==0){this.loadFinish=!0,this.loadingMore=!1;return}let t=[];for(let n in e)this.isFeedItemExist(e[n].feed_item_id)||t.push(e[n]);t.sort(function(n,s){return s.publish_time-n.publish_time}),await this.loadReadedFlag(t),await this.loadReadLaterFlag(t),await this.loadFeedForFeedItem(t),await this.loadAuthorForFeedItem(t),this.feedItems.push(...t),this.buildFeedCount(),this.loadingMore=!1,this.feedItems.length>=100&&(this.loadTooMuch=!0)},clear(){this.loadingMore=!1,this.loadFinish=!1,this.loadTooMuch=!1,this.feedItems=[]},setLoadingMoreState(){this.loadingMore=!0},notifyFeedItemChange(){this.$emit("feedItemCountChange",this.feedItems.length)},isFeedIdExist(e,t){let n=!1;for(let s in t)if(t[s]==e){n=!0;break}return n},buildFeedCount(){let e=[];for(let t in this.feedItems)this.isFeedIdExist(this.feedItems[t].feed_id,e)||e.push(this.feedItems[t].feed_id);this.feedsCount=e.length},async loadReadedFlag(e){let t=[];for(let d in e)e[d].readState=1,this.isFeedIdExist(e[d].feed_item_id,t)||t.push(e[d].feed_item_id);let n=await C.fetchUserFeedItemByIds(y.getDeviceID(),t);if(!g.isResultOk(n))return;let s=n.data;for(let d in e)for(let m in s)if(e[d].feed_item_id==s[m].feed_item_id){e[d].readState=s[m].readed;break}},async loadReadLaterFlag(e){let t=[];for(let s in e)e[s].isReadLater=!1,this.isFeedIdExist(e[s].feed_item_id,t)||t.push(e[s].feed_item_id);let n=await N.getReadLaterByFeedItems(y.getDeviceID(),t);if(g.isResultOk(n))for(let s in e){let d=e[s].feed_item_id;for(let m in n.data)if(n.data[m].feed_item_id==d){e[s].isReadLater=!0;break}}},async loadFeedForFeedItem(e){let t=[];for(let n in e)e[n].feed=null,this.isFeedIdExist(e[n].feed_id,t)||t.push(e[n].feed_id);if(t.length>0){let n=await C.queryFeedByIDs(!1,t);if(g.isResultOk(n)){let s=n.data.list;for(let d in e)for(let m in s)s[m].feed_id==e[d].feed_id&&(e[d].feed=s[m])}}},async loadAuthorForFeedItem(e){let t=[];for(let s in e)e[s].authorList=[],this.isFeedIdExist(e[s].feed_item_id,t)||t.push(e[s].feed_item_id);let n=await se.fetchAuthor(!1,t);if(g.isResultOk(n)){let s=n.data;for(let d in s)for(let m in e)if(s[d].feed_item_id==e[m].feed_item_id){e[m].authorList.push(s[d]);break}}},removeByFeedItemID(e){let t=0;for(;t<this.feedItems.length;)this.feedItems[t].feed_item_id==e?this.feedItems.splice(t,1):++t;this.notifyFeedItemChange()},async onSetFeedItemState(e){let{feedItem:t,readState:n}=e,s=t.readState,d=parseInt(n);t.readState=d;let m=await C.setFeedItemReadState(y.getDeviceID(),t.feed_item_id,d);g.isResultOk(m)?t.readState=d:(t.readState=s,T.error('设置为"'+(d==1?"未读":"已读")+'"失败，请稍后再试。'))},async setReadLater(e){let{feedItem:t}=e,n=await N.setReadLater(y.getDeviceID(),t.feed_id,t.feed_item_id);g.isResultOk(n)?t.isReadLater=!0:T.error('设置“稍后阅读"失败，请稍后再试。')},async removeReadLater(e){let{feedItem:t}=e,n=await N.removeReadLater(y.getDeviceID(),t.feed_item_id);g.isResultOk(n)?t.isReadLater=!1:T.error('取消“稍后阅读"失败，请稍后再试。')},onShareArticle(){},async setAllReaded(){let e=[];for(let n in this.feedItems)e.push(this.feedItems[n].feed_item_id);let t=await C.setFeedItemReadStateV2(y.getDeviceID(),e,2);if(!g.isResultOk(t)){T.error("置为已读失败，请稍后再试。");return}},async onSetReadAndReload(){await this.setAllReaded(),this.$emit("onReload",{})},async onSetReadAndNextPage(){await this.setAllReaded(),this.feedItems=[],this.loadingMore=!0,this.loadTooMuch=!1,this.loadFinish=!1,this.$emit("onLoadMore",{limit:30,feedItemID:"0"})},listenBottomOut(){if(this.loadingMore||this.loadFinish||this.loadTooMuch)return;let e=this.element.scrollTop||document.body.scrollTop,t=this.element.clientHeight,n=this.element.scrollHeight;e+t>=n-this.distance&&this.loadMoreFeedItems()},loadMoreFeedItems(){this.loadingMore=!0;let e=null;if(this.readLaterMode){console.log("load more...");let t=this.feedItems.length;for(let n=t-1;n>=0;n--)if(this.feedItems[n].isReadLater){e=this.feedItems[n];break}}else{let t=this.feedItems.length;for(let n=t-1;n>=0;n--)if(this.feedItems[n].readState==1){e=this.feedItems[n];break}e==null&&(this.loadingMore=!1)}e!=null?this.$emit("onLoadMore",{limit:30,feedItemID:e.feed_item_id}):this.loadingMore=!1}}},"$Mgn71ZVLaX"),Ue={key:0},Ze={key:1},Ge={key:0,style:{display:"flex","align-items":"center"}},Ke=i("img",{style:{height:"20px"},src:"https://oss-cn-hangzhou.aliyuncs.com/codingsky/hellokit/assets/image/1494.gif"},null,-1),Qe=i("span",null," 正在加载，请稍候...",-1),We=[Ke,Qe],Ye={key:1,style:{"text-align":"center"}},xe={key:2,style:{"text-align":"center"}},et=i("p",null,"所有文章已加载。",-1),tt=i("div",{style:{height:"30px"}},null,-1);function ot(e,t,n,s,d,m){const L=_("ThumbItem"),l=_("TextItem"),u=_("Check"),F=Z,k=ie;return r(),p("div",null,[i("div",null,[(r(!0),p(ne,null,ae(e.feedItems,(S,w)=>(r(),p("div",{key:w,style:{"margin-top":"20px","margin-bottom":"20px","border-bottom":"1px solid #eee","padding-bottom":"10px"}},[S.thumb_url.length>0?(r(),p("div",Ue,[o(L,{showFeedName:e.showFeedName,onOnSetFeedItemState:e.onSetFeedItemState,onSetReadLater:e.setReadLater,onRemoveReadLater:e.removeReadLater,feedItem:S},null,8,["showFeedName","onOnSetFeedItemState","onSetReadLater","onRemoveReadLater","feedItem"])])):c("",!0),S.thumb_url.length==0?(r(),p("div",Ze,[o(l,{showFeedName:e.showFeedName,onOnSetFeedItemState:e.onSetFeedItemState,onSetReadLater:e.setReadLater,onRemoveReadLater:e.removeReadLater,feedItem:S},null,8,["showFeedName","onOnSetFeedItemState","onSetReadLater","onRemoveReadLater","feedItem"])])):c("",!0)]))),128))]),e.loadingMore?(r(),p("div",Ge,We)):c("",!0),e.loadTooMuch?(r(),p("div",Ye,[i("p",null,"您已经浏览了来自 "+h(e.feedsCount)+" 个订阅源的 "+h(this.feedItems.length)+" 篇文章。",1),o(k,{onClick:e.onSetReadAndNextPage,size:"large"},{default:a(()=>[I("    "),o(F,{size:24,color:"#757575"},{default:a(()=>[o(u)]),_:1}),I("  全部置为已读  ")]),_:1},8,["onClick"])])):c("",!0),e.loadFinish?(r(),p("div",xe,[et,o(k,{onClick:e.onSetReadAndReload,size:"large"},{default:a(()=>[I("    "),o(F,{size:24,color:"#757575"},{default:a(()=>[o(u)]),_:1}),I("  全部置为已读  ")]),_:1},8,["onClick"])])):c("",!0),tt])}const pt=G(Je,[["render",ot]]);export{pt as F};
