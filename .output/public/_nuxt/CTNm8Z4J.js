import{a9 as de,b5 as De,Q as Re,a3 as xe,y as oe,C as S,a0 as ce,P as Q,bk as Ae,N as j,j as H,b as g,A as w,Z as $e,L as ae,o as C,c as k,a as c,s as L,z as t,t as ue,w as y,k as F,G as Ie,l as Y,B as fe,au as Me,aD as Be,aE as le,J as O,aU as Oe,a1 as Ne,at as Ue,aI as ie,a6 as Ve,R as ze,$ as Ye,v as me,V as We,U as qe,x as pe,_ as te,f as ne,i as z,d as Z,p as ve,e as he,r as J}from"./Bq77BlN_.js";import{E as Ke}from"./C_5h5fBQ.js";import{b as se,d as X,_ as ye,w as He}from"./nUV19QSN.js";import{F as Pe,i as Xe,E as Ge,a as je}from"./CVumo1Vz.js";import{G as ee,R as re,y as Qe,A as Fe,x as Ze,E as ge,S as _e}from"./B_gWlXuQ.js";import{i as Je,C as eo}from"./BJGnmqG5.js";import{u as oo}from"./Co8Oxmti.js";import{c as to}from"./Cz4HgUVE.js";import{U as Ce}from"./HEVJa2N9.js";import{a as no}from"./CSi15Dr6.js";import{t as so}from"./Cq9Fpw4b.js";import{g as ao}from"./CRLszMoI.js";import{a as lo}from"./DDKaLnTg.js";import{e as be}from"./E5P-NQ8u.js";import{u as K}from"./Dhnu2qvC.js";import{E as io}from"./HOwwVasf.js";/* empty css        */var P=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(P||{});const ro=(e,o,a,f)=>{let l={offsetX:0,offsetY:0};const r=u=>{const p=u.clientX,E=u.clientY,{offsetX:b,offsetY:v}=l,h=e.value.getBoundingClientRect(),T=h.left,m=h.top,N=h.width,D=h.height,W=document.documentElement.clientWidth,q=document.documentElement.clientHeight,U=-T+b,R=-m+v,x=W-T-N+b,A=q-m-D+v,$=i=>{let M=b+i.clientX-p,V=v+i.clientY-E;f!=null&&f.value||(M=Math.min(Math.max(M,U),x),V=Math.min(Math.max(V,R),A)),l={offsetX:M,offsetY:V},e.value&&(e.value.style.transform=`translate(${ee(M)}, ${ee(V)})`)},I=()=>{document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",I)};document.addEventListener("mousemove",$),document.addEventListener("mouseup",I)},n=()=>{o.value&&e.value&&o.value.addEventListener("mousedown",r)},d=()=>{o.value&&e.value&&o.value.removeEventListener("mousedown",r)},s=()=>{l={offsetX:0,offsetY:0},e.value&&(e.value.style.transform="none")};return de(()=>{De(()=>{a.value?n():d()})}),Re(()=>{d()}),{resetPostion:s}},co=(e,o={})=>{xe(e)||so("[useLockscreen]","You need to pass a ref param to this function");const a=o.ns||oe("popup"),f=S(()=>a.bm("parent","hidden"));if(!ce||re(document.body,f.value))return;let l=0,r=!1,n="0";const d=()=>{setTimeout(()=>{Ze(document==null?void 0:document.body,f.value),r&&document&&(document.body.style.width=n)},200)};Q(e,s=>{if(!s){d();return}r=!re(document.body,f.value),r&&(n=document.body.style.width),l=ao(a.namespace.value);const u=document.documentElement.clientHeight<document.body.scrollHeight,p=Qe(document.body,"overflowY");l>0&&(u||p==="scroll")&&r&&(document.body.style.width=`calc(100% - ${l}px)`),Fe(document.body,f.value)}),Ae(()=>d())},Ee=e=>{if(!e)return{onClick:j,onMousedown:j,onMouseup:j};let o=!1,a=!1;return{onClick:n=>{o&&a&&e(n),o=a=!1},onMousedown:n=>{o=n.target===n.currentTarget},onMouseup:n=>{a=n.target===n.currentTarget}}},uo=se({mask:{type:Boolean,default:!0},customMaskEvent:Boolean,overlayClass:{type:X([String,Array,Object])},zIndex:{type:X([String,Number])}}),fo={click:e=>e instanceof MouseEvent},mo="overlay";var po=H({name:"ElOverlay",props:uo,emits:fo,setup(e,{slots:o,emit:a}){const f=oe(mo),l=s=>{a("click",s)},{onClick:r,onMousedown:n,onMouseup:d}=Ee(e.customMaskEvent?void 0:l);return()=>e.mask?g("div",{class:[f.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:r,onMousedown:n,onMouseup:d},[w(o,"default")],P.STYLE|P.CLASS|P.PROPS,["onClick","onMouseup","onMousedown"]):$e("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[w(o,"default")])}});const vo=po,we=Symbol("dialogInjectionKey"),ke=se({center:Boolean,alignCenter:Boolean,closeIcon:{type:Je},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),ho={close:()=>!0},yo=H({name:"ElDialogContent"}),go=H({...yo,props:ke,emits:ho,setup(e,{expose:o}){const a=e,{t:f}=oo(),{Close:l}=eo,{dialogRef:r,headerRef:n,bodyId:d,ns:s,style:u}=ae(we),{focusTrapRef:p}=ae(Pe),E=S(()=>[s.b(),s.is("fullscreen",a.fullscreen),s.is("draggable",a.draggable),s.is("align-center",a.alignCenter),{[s.m("center")]:a.center}]),b=to(p,r),v=S(()=>a.draggable),h=S(()=>a.overflow),{resetPostion:T}=ro(r,n,v,h);return o({resetPostion:T}),(m,N)=>(C(),k("div",{ref:t(b),class:L(t(E)),style:fe(t(u)),tabindex:"-1"},[c("header",{ref_key:"headerRef",ref:n,class:L([t(s).e("header"),{"show-close":m.showClose}])},[w(m.$slots,"header",{},()=>[c("span",{role:"heading","aria-level":m.ariaLevel,class:L(t(s).e("title"))},ue(m.title),11,["aria-level"])]),m.showClose?(C(),k("button",{key:0,"aria-label":t(f)("el.dialog.close"),class:L(t(s).e("headerbtn")),type:"button",onClick:D=>m.$emit("close")},[g(t(ge),{class:L(t(s).e("close"))},{default:y(()=>[(C(),F(Ie(m.closeIcon||t(l))))]),_:1},8,["class"])],10,["aria-label","onClick"])):Y("v-if",!0)],2),c("div",{id:t(d),class:L(t(s).e("body"))},[w(m.$slots,"default")],10,["id"]),m.$slots.footer?(C(),k("footer",{key:0,class:L(t(s).e("footer"))},[w(m.$slots,"footer")],2)):Y("v-if",!0)],6))}});var _o=ye(go,[["__file","dialog-content.vue"]]);const Co=se({...ke,appendToBody:Boolean,appendTo:{type:X([String,Object]),default:"body"},beforeClose:{type:X(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"}}),bo={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[Ce]:e=>Me(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},Eo=(e,o)=>{var a;const l=Ue().emit,{nextZIndex:r}=Be();let n="";const d=le(),s=le(),u=O(!1),p=O(!1),E=O(!1),b=O((a=e.zIndex)!=null?a:r());let v,h;const T=no("namespace",Oe),m=S(()=>{const _={},B=`--${T.value}-dialog`;return e.fullscreen||(e.top&&(_[`${B}-margin-top`]=e.top),e.width&&(_[`${B}-width`]=ee(e.width))),_}),N=S(()=>e.alignCenter?{display:"flex"}:{});function D(){l("opened")}function W(){l("closed"),l(Ce,!1),e.destroyOnClose&&(E.value=!1)}function q(){l("close")}function U(){h==null||h(),v==null||v(),e.openDelay&&e.openDelay>0?{stop:v}=ie(()=>$(),e.openDelay):$()}function R(){v==null||v(),h==null||h(),e.closeDelay&&e.closeDelay>0?{stop:h}=ie(()=>I(),e.closeDelay):I()}function x(){function _(B){B||(p.value=!0,u.value=!1)}e.beforeClose?e.beforeClose(_):R()}function A(){e.closeOnClickModal&&x()}function $(){ce&&(u.value=!0)}function I(){u.value=!1}function i(){l("openAutoFocus")}function M(){l("closeAutoFocus")}function V(_){var B;((B=_.detail)==null?void 0:B.focusReason)==="pointer"&&_.preventDefault()}e.lockScroll&&co(u);function Se(){e.closeOnPressEscape&&x()}return Q(()=>e.modelValue,_=>{_?(p.value=!1,U(),E.value=!0,b.value=Xe(e.zIndex)?r():b.value++,Ne(()=>{l("open"),o.value&&(o.value.scrollTop=0)})):u.value&&R()}),Q(()=>e.fullscreen,_=>{o.value&&(_?(n=o.value.style.transform,o.value.style.transform=""):o.value.style.transform=n)}),de(()=>{e.modelValue&&(u.value=!0,E.value=!0,U())}),{afterEnter:D,afterLeave:W,beforeLeave:q,handleClose:x,onModalClick:A,close:R,doClose:I,onOpenAutoFocus:i,onCloseAutoFocus:M,onCloseRequested:Se,onFocusoutPrevented:V,titleId:d,bodyId:s,closed:p,style:m,overlayDialogStyle:N,rendered:E,visible:u,zIndex:b}},wo=H({name:"ElDialog",inheritAttrs:!1}),ko=H({...wo,props:Co,emits:bo,setup(e,{expose:o}){const a=e,f=Ve();lo({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},S(()=>!!f.title));const l=oe("dialog"),r=O(),n=O(),d=O(),{visible:s,titleId:u,bodyId:p,style:E,overlayDialogStyle:b,rendered:v,zIndex:h,afterEnter:T,afterLeave:m,beforeLeave:N,handleClose:D,onModalClick:W,onOpenAutoFocus:q,onCloseAutoFocus:U,onCloseRequested:R,onFocusoutPrevented:x}=Eo(a,r);ze(we,{dialogRef:r,headerRef:n,bodyId:p,ns:l,rendered:v,style:E});const A=Ee(W),$=S(()=>a.draggable&&!a.fullscreen);return o({visible:s,dialogContentRef:d,resetPostion:()=>{d.value.resetPostion()}}),(i,M)=>(C(),F(t(je),{to:i.appendTo,disabled:i.appendTo!=="body"?!1:!i.appendToBody},{default:y(()=>[g(Ye,{name:"dialog-fade",onAfterEnter:t(T),onAfterLeave:t(m),onBeforeLeave:t(N),persisted:""},{default:y(()=>[me(g(t(vo),{"custom-mask-event":"",mask:i.modal,"overlay-class":i.modalClass,"z-index":t(h)},{default:y(()=>[c("div",{role:"dialog","aria-modal":"true","aria-label":i.title||void 0,"aria-labelledby":i.title?void 0:t(u),"aria-describedby":t(p),class:L(`${t(l).namespace.value}-overlay-dialog`),style:fe(t(b)),onClick:t(A).onClick,onMousedown:t(A).onMousedown,onMouseup:t(A).onMouseup},[g(t(Ge),{loop:"",trapped:t(s),"focus-start-el":"container",onFocusAfterTrapped:t(q),onFocusAfterReleased:t(U),onFocusoutPrevented:t(x),onReleaseRequested:t(R)},{default:y(()=>[t(v)?(C(),F(_o,We({key:0,ref_key:"dialogContentRef",ref:d},i.$attrs,{center:i.center,"align-center":i.alignCenter,"close-icon":i.closeIcon,draggable:t($),overflow:i.overflow,fullscreen:i.fullscreen,"show-close":i.showClose,title:i.title,"aria-level":i.headerAriaLevel,onClose:t(D)}),qe({header:y(()=>[i.$slots.title?w(i.$slots,"title",{key:1}):w(i.$slots,"header",{key:0,close:t(D),titleId:t(u),titleClass:t(l).e("title")})]),default:y(()=>[w(i.$slots,"default")]),_:2},[i.$slots.footer?{name:"footer",fn:y(()=>[w(i.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","show-close","title","aria-level","onClose"])):Y("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[pe,t(s)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var To=ye(ko,[["__file","dialog.vue"]]);const Te=He(To),Lo=ne({components:{RefreshLeft:_e},async asyncData(){return{dialogVisible:!1}},mounted(){be.on("on_popup_anonymity_warning",e=>{this.show()})},methods:{show(){this.dialogVisible=!0},gotoMainPage(){z.saveKV("hellokit.reader.state","inited"),setTimeout(()=>{window.location.href="/my/today"},200)}}},"$lE07lWksYK"),Le=e=>(ve("data-v-0a68e204"),e=e(),he(),e),So={style:{padding:"0px 0px 10px 0px"}},Do=Le(()=>c("p",{class:"normal"},"匿名使用时，您的标识信息存储在浏览器本地。",-1)),Ro=Le(()=>c("p",{class:"danger"},"重装浏览器或者使用第三方软件清理浏览器Cookie、缓存等有可能导致账号信息丢失。",-1)),xo={style:{"text-align":"right"}};function Ao(e,o,a,f,l,r){const n=Ke,d=Te;return C(),k("div",null,[g(d,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=s=>e.dialogVisible=s),title:"您即将匿名使用哈喽阅读",width:"500"},{default:y(()=>[c("div",So,[Do,Ro,c("div",xo,[g(n,{type:"primary",size:"large",onClick:e.gotoMainPage},{default:y(()=>[Z("我知道了")]),_:1},8,["onClick"])])])]),_:1},8,["modelValue"])])}const $o=te(Lo,[["render",Ao],["__scopeId","data-v-0a68e204"]]),Io=ne({components:{RefreshLeft:_e},async asyncData(){return{dialogVisible:!1,errorText:"",qrcodeURL:""}},mounted(){be.on("on_popup_wechatlogin",e=>{this.show()})},methods:{show(){this.dialogVisible=!0,this.loadQRCode()},handleClose(){},async loadQRCode(){let e=await K.getWxLoginURL();if(!z.isResultOk(e)||e.data.ticket.length==0){this.errorText="获取登录二唯码失败。";return}this.ticket=e.data.ticket,this.url=e.data.url,this.expireSecond=e.data.expire_seconds,this.qrcodeURL="https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e.data.ticket,this.errorText="",this.checkLoginState()},async checkLoginState(){if(this.dialogVisible==!1)return;let e=await K.fetchWxLoginState(this.ticket);if(z.isResultOk(e))if(e.data.state==1)setTimeout(()=>{this.checkLoginState()},500);else if(e.data.state==2){let o=e.data.token;this.refreshUserInfo(o)}else e.data.state>2&&(this.qrcodeURL="",this.errorText="登录失败，请刷新二唯码以重试。")},onRefreshQR(){this.loadQRCode()},async refreshUserInfo(e){let o=await K.getMyUserInfoWithToken(e);if(!z.isResultOk(o)){this.qrcodeURL="",this.errorText="获取用户信息失败，请刷新二唯码以重试。";return}K.saveAuthWithWxCookie(o.data.uid,o.data.name,o.data.mobile,o.data.email,o.data.wx_open_id,e),K.saveLocalUser(o.data),this.postLoginRedirect()},postLoginRedirect(){z.saveKV("hellokit.reader.state","inited"),setTimeout(()=>{let e=z.getK("login_ref_src");e!=null&&e!=null&&e.length>0?window.location.href=e:window.location.href="/"},50)}}},"$WvC7CNkdmg"),G=e=>(ve("data-v-5543374d"),e=e(),he(),e),Mo={style:{"text-align":"center"}},Bo={style:{height:"152px",overflow:"hidden"}},Oo={style:{"z-index":"100",border:"1px solid #eee",width:"150px",height:"150px",margin:"0px auto"}},No=["src"],Uo={key:0,style:{"z-index":"101",width:"150px",height:"150px","text-align":"center","margin-left":"auto","margin-right":"auto"}},Vo={key:0,style:{width:"50px",height:"50px","margin-top":"50px","margin-left":"0px"},src:"https://oss-cn-hangzhou.aliyuncs.com/codingsky/hellokit/assets/tools/pdf/loading.gif"},zo=G(()=>c("div",{style:{height:"50px"}},null,-1)),Yo={style:{"font-size":"60px"}},Wo={style:{color:"red","font-size":"14px","font-weight":"500","margin-right":"10px"}},qo=G(()=>c("p",{style:{"font-size":"16px","margin-top":"3px","margin-bottom":"3px"}},"微信扫码并关注公众号完成登录",-1)),Ko={class:"button-container"},Ho={style:{height:"40px",display:"flex","justify-content":"center"}},Po=G(()=>c("div",{style:{flex:"1"}},null,-1)),Xo=G(()=>c("span",null,"    ",-1));function Go(e,o,a,f,l,r){const n=J("RefreshLeft"),d=ge,s=io,u=Te;return C(),k("div",null,[g(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=p=>e.dialogVisible=p),title:"使用微信登录",width:"500"},{default:y(()=>[c("div",null,[c("div",Mo,[c("div",Bo,[c("div",Oo,[me(c("img",{style:{width:"148px",height:"148px"},src:e.qrcodeURL},null,8,No),[[pe,e.qrcodeURL!=""]]),e.qrcodeURL==""&&e.errorText.length==0?(C(),k("div",Uo,[e.qrcodeURL==""?(C(),k("img",Vo)):Y("",!0)])):Y("",!0),e.errorText.length>0?(C(),k("div",{key:1,onClick:o[0]||(o[0]=(...p)=>e.onRefreshQR&&e.onRefreshQR(...p)),style:{"z-index":"101",width:"150px",height:"150px","text-align":"center","margin-left":"auto","margin-right":"auto"}},[zo,c("span",Yo,[g(d,null,{default:y(()=>[g(n)]),_:1})])])):Y("",!0)])]),c("p",Wo,ue(e.errorText),1),qo]),c("div",Ko,[c("div",Ho,[Po,g(s,{underline:!1,type:"primary",href:"/user/login",style:{"font-size":"14px"}},{default:y(()=>[Z("使用手机验证码登录")]),_:1}),Xo,g(s,{underline:!1,type:"primary",href:"/user/password/login",style:{"font-size":"14px"}},{default:y(()=>[Z("使用账号密码登录")]),_:1})])])])]),_:1},8,["modelValue"])])}const jo=te(Io,[["render",Go],["__scopeId","data-v-5543374d"]]),Qo=ne({components:{WechatLoginDialog:jo,AnonymityWarning:$o},async asyncData(){return{}},methods:{}},"$Kq7I2U8c2M");function Fo(e,o,a,f,l,r){const n=J("WechatLoginDialog"),d=J("AnonymityWarning");return C(),k("div",null,[g(n),g(d)])}const vt=te(Qo,[["render",Fo]]);export{vt as A,vo as E,bo as a,Co as d,Eo as u};
